(()=>{"use strict";const e="all";var t;!function(e){e.CREATE_SITE="create site",e.QUERY="query",e.DELETE_SITE="delete site",e.UPDATED="updated",e.UPDATE_ALL="updateAll",e.SORT_SITES="sort sites"}(t||(t={}));const i=e=>({type:t.UPDATED,data:{searchConfig:e}});var s=function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};const o={name:"filetype",options:[{label:"Filetype",value:e},{label:"PDF",value:"pdf"},{label:"Word",value:"doc,docx"},{label:"Excel",value:"xls,xlsx"},{label:"PPT",value:"ppt,pptx"}],value:e};var n=function(e,t,i,s){return new(i||(i=Promise))((function(o,n){function a(e){try{l(s.next(e))}catch(e){n(e)}}function r(e){try{l(s.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((s=s.apply(e,t||[])).next())}))};const a=new class{constructor(){this.sitesKey="sites",this.filtersKey="filters",this.getSearchConfig=()=>s(this,void 0,void 0,(function*(){return yield chrome.storage.local.get({[this.filtersKey]:[],[this.sitesKey]:[]})})),this.setSearchConfig=e=>s(this,void 0,void 0,(function*(){yield chrome.storage.local.set({[this.filtersKey]:e.filters.map(this.resetFilterStatus),[this.sitesKey]:e.sites.map(this.resetSiteStatus)})})),this.resetSiteStatus=e=>Object.assign(Object.assign({},e),{isActive:!1}),this.resetFilterStatus=t=>Object.assign(Object.assign({},t),{value:e}),this.addSite=e=>s(this,void 0,void 0,(function*(){e=this.resetSiteStatus(e);const t=yield this.getSites();t.find((t=>t.domain===e.domain))||(t.push(e),yield this.setSites(t))})),this.removeSite=e=>s(this,void 0,void 0,(function*(){const t=yield this.getSites(),i=t.findIndex((t=>t.domain===e.domain));-1!==i&&(t.splice(i,1),yield this.setSites(t))})),this.getSites=()=>s(this,void 0,void 0,(function*(){return(yield chrome.storage.local.get({[this.sitesKey]:[]}))[this.sitesKey]})),this.setSites=e=>s(this,void 0,void 0,(function*(){yield chrome.storage.local.set({[this.sitesKey]:e.map(this.resetSiteStatus)})})),this.getFilters=()=>s(this,void 0,void 0,(function*(){return(yield chrome.storage.local.get({[this.filtersKey]:[]}))[this.filtersKey]})),this.addFilter=e=>s(this,void 0,void 0,(function*(){e=this.resetFilterStatus(e);const t=yield this.getFilters(),i=t.find((t=>t.name===e.name));i?t.splice(t.indexOf(i),1,e):t.push(e),yield chrome.storage.local.set({[this.filtersKey]:t})})),this.removeFilter=e=>s(this,void 0,void 0,(function*(){const t=yield this.getFilters(),i=t.find((t=>t.name===e.name));i&&(t.splice(t.indexOf(i),1),yield chrome.storage.local.set({[this.filtersKey]:t}))})),this.setFilters=e=>s(this,void 0,void 0,(function*(){yield chrome.storage.local.set({[this.filtersKey]:e.map(this.resetFilterStatus)})}))}};function r(){return n(this,void 0,void 0,(function*(){let e=yield a.getSearchConfig();0===e.filters.length&&(yield a.setFilters([o])),e=yield a.getSearchConfig(),yield function(e){return n(this,void 0,void 0,(function*(){try{yield chrome.runtime.sendMessage(i(e))}catch(e){console.log("Failed to send message to popup",e)}}))}(e),yield function(e){return n(this,void 0,void 0,(function*(){(yield chrome.tabs.query({})).forEach((t=>n(this,void 0,void 0,(function*(){if(t.id)try{yield chrome.tabs.sendMessage(t.id,i(e))}catch(e){console.log("Failed to send message to tab",t.id,e)}}))))}))}(e)}))}chrome.runtime.onMessage.addListener(((e,i,s)=>{let o=Promise.resolve();switch(e.type){case t.QUERY:break;case t.CREATE_SITE:o=a.addSite(e.data);break;case t.DELETE_SITE:o=a.removeSite(e.data);break;case t.UPDATE_ALL:o=a.setSearchConfig(e.data);break;case t.SORT_SITES:o=a.setSites(e.data);break;default:throw`Unknown message: ${e}`}return o.then(r).then(s),!0}))})();